<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Makarska Dining v2.3.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="css/main.css" />
</head>
<body>

    <!-- ==================== LOGIN SCREEN ==================== -->
    <div id="loginScreen" class="auth-screen login-screen">
        <!-- Makarska Beach Banner -->
        <div class="login-banner">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 400" preserveAspectRatio="xMidYMid slice">
                <defs>
                    <linearGradient id="cartoonSky2" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#87CEEB"/>
                        <stop offset="60%" style="stop-color:#B8E8F0"/>
                        <stop offset="100%" style="stop-color:#F0F8E0"/>
                    </linearGradient>
                    <linearGradient id="cartoonSea2" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#40C4AA"/>
                        <stop offset="100%" style="stop-color:#20A088"/>
                    </linearGradient>
                </defs>
                <rect x="0" y="0" width="1200" height="400" fill="url(#cartoonSky2)"/>
                <circle cx="1050" cy="80" r="80" fill="#FFF8E0" opacity="0.5"/>
                <circle cx="1050" cy="80" r="50" fill="#FFFDE8" opacity="0.7"/>
                <g fill="#FFFFFF">
                    <ellipse cx="180" cy="55" rx="60" ry="30"/>
                    <ellipse cx="230" cy="50" rx="45" ry="25"/>
                    <ellipse cx="135" cy="52" rx="38" ry="22"/>
                    <ellipse cx="200" cy="68" rx="32" ry="18"/>
                    <ellipse cx="600" cy="40" rx="70" ry="35"/>
                    <ellipse cx="660" cy="35" rx="50" ry="28"/>
                    <ellipse cx="545" cy="42" rx="42" ry="24"/>
                    <ellipse cx="850" cy="65" rx="55" ry="28"/>
                    <ellipse cx="900" cy="60" rx="40" ry="22"/>
                </g>
                <path d="M0 400 L70 230 C130 200 180 230 250 190 C340 140 400 170 480 130 C580 80 650 110 740 80 C840 50 920 90 1000 100 C1100 110 1150 150 1200 170 L1200 400 Z" fill="#B8A8C8"/>
                <path d="M40 400 L140 270 C210 240 270 270 350 230 C450 180 520 210 620 180 C720 145 790 175 890 160 C990 145 1060 185 1150 205 L1200 230 L1200 400 Z" fill="#8BAA90"/>
                <path d="M180 400 L300 315 C390 290 470 305 560 285 C670 260 750 280 860 275 C970 270 1050 300 1150 325 L1200 345 L1200 400 Z" fill="#5CAD5C"/>
                <g fill="#4A9648">
                    <ellipse cx="380" cy="305" rx="55" ry="28"/>
                    <ellipse cx="540" cy="290" rx="60" ry="30"/>
                    <ellipse cx="720" cy="282" rx="58" ry="28"/>
                    <ellipse cx="920" cy="295" rx="65" ry="32"/>
                    <ellipse cx="1100" cy="320" rx="55" ry="28"/>
                </g>
                <g>
                    <ellipse cx="320" cy="290" rx="24" ry="32" fill="#3D8E3D"/>
                    <rect x="316" y="315" width="8" height="18" fill="#9B7B5A"/>
                    <ellipse cx="460" cy="278" rx="28" ry="35" fill="#4CA84C"/>
                    <rect x="456" y="306" width="8" height="18" fill="#9B7B5A"/>
                    <ellipse cx="640" cy="272" rx="22" ry="30" fill="#3D8E3D"/>
                    <rect x="636" y="295" width="8" height="16" fill="#9B7B5A"/>
                    <ellipse cx="820" cy="278" rx="26" ry="33" fill="#4CA84C"/>
                    <rect x="816" y="304" width="8" height="16" fill="#9B7B5A"/>
                </g>
                <g>
                    <rect x="560" y="268" width="38" height="87" rx="3" fill="#F5E0C8"/>
                    <rect x="608" y="258" width="42" height="97" rx="3" fill="#FFF0D8"/>
                    <rect x="660" y="235" width="50" height="120" rx="4" fill="#FFE878"/>
                    <rect x="666" y="245" width="11" height="14" rx="2" fill="#90D8F0"/>
                    <rect x="682" y="245" width="11" height="14" rx="2" fill="#90D8F0"/>
                    <rect x="698" y="245" width="11" height="14" rx="2" fill="#90D8F0"/>
                    <rect x="666" y="267" width="11" height="14" rx="2" fill="#90D8F0"/>
                    <rect x="682" y="267" width="11" height="14" rx="2" fill="#90D8F0"/>
                    <rect x="698" y="267" width="11" height="14" rx="2" fill="#90D8F0"/>
                    <rect x="666" y="289" width="11" height="14" rx="2" fill="#90D8F0"/>
                    <rect x="682" y="289" width="11" height="14" rx="2" fill="#90D8F0"/>
                    <rect x="698" y="289" width="11" height="14" rx="2" fill="#90D8F0"/>
                    <rect x="666" y="311" width="11" height="14" rx="2" fill="#90D8F0"/>
                    <rect x="682" y="311" width="11" height="14" rx="2" fill="#90D8F0"/>
                    <rect x="698" y="311" width="11" height="14" rx="2" fill="#90D8F0"/>
                    <rect x="720" y="285" width="40" height="70" rx="3" fill="#FFB088"/>
                    <path d="M717 285 L740 250 L763 285 Z" fill="#E86850"/>
                    <rect x="728" y="302" width="12" height="16" rx="2" fill="#90D8F0"/>
                    <rect x="746" y="302" width="12" height="16" rx="2" fill="#90D8F0"/>
                    <rect x="728" y="325" width="24" height="28" rx="2" fill="#7B5B4A"/>
                    <rect x="770" y="292" width="45" height="63" rx="3" fill="#C8E8A8"/>
                    <path d="M767 292 L792 255 L817 292 Z" fill="#88C878"/>
                    <rect x="780" y="308" width="14" height="18" rx="2" fill="#90D8F0"/>
                    <rect x="800" y="308" width="14" height="18" rx="2" fill="#90D8F0"/>
                    <rect x="825" y="285" width="38" height="70" rx="3" fill="#FFE0A0"/>
                    <path d="M822 285 L844 252 L866 285 Z" fill="#FFAA50"/>
                    <rect x="833" y="300" width="12" height="15" rx="2" fill="#90D8F0"/>
                    <rect x="850" y="300" width="12" height="15" rx="2" fill="#90D8F0"/>
                    <rect x="873" y="298" width="42" height="57" rx="3" fill="#A8D8E8"/>
                    <path d="M870 298 L894 265 L918 298 Z" fill="#78B8D0"/>
                    <rect x="883" y="312" width="13" height="16" rx="2" fill="#F0F8FF"/>
                    <rect x="902" y="312" width="13" height="16" rx="2" fill="#F0F8FF"/>
                    <rect x="925" y="292" width="38" height="63" rx="3" fill="#FFD0D8"/>
                    <path d="M922 292 L944 260 L966 292 Z" fill="#F0909A"/>
                    <rect x="973" y="300" width="40" height="55" rx="3" fill="#F5E0C8"/>
                    <rect x="1023" y="295" width="38" height="60" rx="3" fill="#FFF0D8"/>
                    <rect x="1071" y="302" width="42" height="53" rx="3" fill="#D8F0D0"/>
                    <rect x="1123" y="308" width="38" height="47" rx="3" fill="#FFE0A0"/>
                </g>
                <g>
                    <rect x="825" y="335" width="40" height="18" fill="#FFF0D8"/>
                    <path d="M820 335 Q830 342 840 335 Q850 342 860 335 Q870 342 870 335 L870 328 L820 328 Z" fill="#E74C3C"/>
                    <path d="M830 335 Q840 342 850 335" fill="none" stroke="#FFFFFF" stroke-width="3"/>
                </g>
                <path d="M0 355 Q300 345 600 355 Q900 365 1200 355 L1200 400 L0 400 Z" fill="url(#cartoonSea2)"/>
                <g fill="#FFFFFF" opacity="0.5">
                    <ellipse cx="350" cy="362" rx="18" ry="5"/>
                    <ellipse cx="520" cy="370" rx="14" ry="4"/>
                    <ellipse cx="680" cy="365" rx="20" ry="5"/>
                    <ellipse cx="850" cy="372" rx="16" ry="4"/>
                    <ellipse cx="1020" cy="362" rx="18" ry="5"/>
                </g>
                <path d="M0 360 Q200 352 380 365 Q500 378 600 400 L0 400 Z" fill="#F8DDA8"/>
                <path d="M0 375 Q170 368 330 380 Q450 395 530 400 L0 400 Z" fill="#ECCB90"/>
                <g>
                    <rect x="138" y="352" width="5" height="30" fill="#9B7B5A" rx="2"/>
                    <ellipse cx="140" cy="348" rx="30" ry="13" fill="#E74C3C"/>
                    <path d="M110 348 Q125 340 140 348 Q155 340 170 348" fill="#FFFFFF" opacity="0.7"/>
                    <rect x="258" y="360" width="5" height="27" fill="#9B7B5A" rx="2"/>
                    <ellipse cx="260" cy="356" rx="28" ry="12" fill="#20A088"/>
                    <ellipse cx="260" cy="354" rx="18" ry="7" fill="#40C4AA" opacity="0.5"/>
                    <rect x="378" y="372" width="5" height="22" fill="#9B7B5A" rx="2"/>
                    <ellipse cx="380" cy="368" rx="26" ry="11" fill="#FF9040"/>
                    <ellipse cx="380" cy="366" rx="16" ry="6" fill="#FFB070" opacity="0.5"/>
                    <rect x="488" y="382" width="5" height="18" fill="#9B7B5A" rx="2"/>
                    <ellipse cx="490" cy="378" rx="24" ry="10" fill="#F8D850"/>
                </g>
                <rect x="175" y="368" width="28" height="14" rx="3" fill="#9B59B6"/>
                <rect x="295" y="375" width="25" height="12" rx="3" fill="#E74C3C"/>
                <rect x="415" y="385" width="26" height="10" rx="3" fill="#3498DB"/>
                <g>
                    <path d="M60 400 Q68 355 78 310 Q84 280 76 252 L70 248 Q84 242 100 248 L94 252 Q86 280 92 310 Q102 355 110 400 Z" fill="#9B7B5A"/>
                    <path d="M84 268 Q160 210 300 185 Q345 178 375 192 Q330 188 275 202 Q175 230 90 280 Z" fill="#9B7B5A"/>
                    <ellipse cx="320" cy="135" rx="70" ry="55" fill="#3D8E3D"/>
                    <ellipse cx="255" cy="168" rx="58" ry="45" fill="#4CA84C"/>
                    <ellipse cx="385" cy="158" rx="52" ry="42" fill="#3D8E3D"/>
                    <ellipse cx="190" cy="195" rx="50" ry="40" fill="#4CA84C"/>
                    <ellipse cx="125" cy="222" rx="55" ry="44" fill="#3D8E3D"/>
                    <ellipse cx="68" cy="252" rx="48" ry="38" fill="#4CA84C"/>
                    <ellipse cx="435" cy="185" rx="42" ry="35" fill="#3D8E3D"/>
                    <ellipse cx="300" cy="125" rx="22" ry="16" fill="#6BC86B" opacity="0.6"/>
                    <ellipse cx="240" cy="160" rx="18" ry="14" fill="#6BC86B" opacity="0.6"/>
                    <ellipse cx="115" cy="212" rx="20" ry="15" fill="#6BC86B" opacity="0.6"/>
                    <ellipse cx="370" cy="148" rx="16" ry="12" fill="#6BC86B" opacity="0.6"/>
                </g>
                <g>
                    <ellipse cx="620" cy="360" rx="24" ry="7" fill="#FFFFFF"/>
                    <polygon points="620,358 620,318 642,350" fill="#FFFFFF"/>
                    <polygon points="618,358 618,330 602,352" fill="#F8F8F8"/>
                    <line x1="620" y1="358" x2="620" y2="315" stroke="#9B7B5A" stroke-width="2"/>
                    <ellipse cx="780" cy="368" rx="22" ry="6" fill="#FFFFFF"/>
                    <polygon points="780,366 780,330 800,358" fill="#FFE0A0"/>
                    <line x1="780" y1="366" x2="780" y2="328" stroke="#9B7B5A" stroke-width="2"/>
                    <ellipse cx="950" cy="360" rx="20" ry="6" fill="#FFFFFF"/>
                    <polygon points="950,358 950,325 968,352" fill="#A8D8E8"/>
                    <line x1="950" y1="358" x2="950" y2="322" stroke="#9B7B5A" stroke-width="2"/>
                </g>
                <ellipse cx="500" cy="362" rx="14" ry="5" fill="#E74C3C" opacity="0.8"/>
                <ellipse cx="700" cy="370" rx="12" ry="4" fill="#F8D850" opacity="0.8"/>
            </svg>
        </div>
        <div class="login-header">
            <div class="login-title">Makarska Dining</div>
            <div class="login-subtitle">Rate restaurants with friends</div>
        </div>
        <div class="login-buttons">
            <div id="loginFormContainer">
                <div class="login-form-group">
                    <input type="text" id="loginUsername" class="login-input" placeholder="Username" autocomplete="username">
                </div>
                <div class="login-form-group">
                    <input type="password" id="loginPassword" class="login-input" placeholder="Password" autocomplete="current-password">
                </div>
                <div id="loginError" class="login-error"></div>
                <button class="login-btn login-btn-primary" onclick="handleEmailLogin()">
                    Sign In
                </button>
                <div class="login-divider">or</div>
                <button class="login-btn login-btn-secondary" onclick="showRegisterForm()">
                    Create Account
                </button>
            </div>
            <div id="registerFormContainer" style="display: none;">
                <div class="login-form-group">
                    <input type="text" id="registerUsername" class="login-input" placeholder="Username" autocomplete="username">
                </div>
                <div class="login-form-group">
                    <input type="password" id="registerPassword" class="login-input" placeholder="Password" autocomplete="new-password">
                </div>
                <div class="login-form-group">
                    <input type="password" id="registerPasswordConfirm" class="login-input" placeholder="Confirm Password" autocomplete="new-password">
                </div>
                <div id="registerError" class="login-error"></div>
                <button class="login-btn login-btn-primary" onclick="handleRegister()">
                    Create Account
                </button>
                <div class="login-divider">or</div>
                <button class="login-btn login-btn-secondary" onclick="showLoginForm()">
                    Back to Sign In
                </button>
            </div>
        </div>
    </div>

    <!-- ==================== EMPTY STATE SCREEN ==================== -->
    <div id="emptyStateScreen" class="auth-screen empty-state-screen hidden">
        <div class="empty-header">
            <div class="empty-header-top">
                <div class="empty-title">My Groups</div>
                <button class="logout-btn" onclick="handleLogout()" title="Sign Out">
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16 17 21 12 16 7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                </button>
            </div>
            <div class="empty-subtitle">No groups yet</div>
        </div>
        <div class="empty-content">
            <div class="empty-icon">üë•</div>
            <div class="empty-content-title">No Groups Yet</div>
            <div class="empty-content-text">Create a group to start rating<br>restaurants with friends</div>
            <button class="empty-btn-primary" onclick="showCreateGroup()">+ Create Group</button>
            <button class="empty-btn-secondary" onclick="showJoinGroup()">Join with Code</button>
        </div>
        <div class="empty-bottom-nav">
            <button class="empty-nav-item active">
                <div class="empty-nav-icon">üë•</div>
                <div class="empty-nav-label">Groups</div>
            </button>
            <button class="empty-nav-item">
                <div class="empty-nav-icon">üó∫Ô∏è</div>
                <div class="empty-nav-label">Explore</div>
            </button>
            <button class="empty-nav-item">
                <div class="empty-nav-icon">üë§</div>
                <div class="empty-nav-label">Profile</div>
            </button>
        </div>
    </div>

    <!-- ==================== CREATE GROUP SCREEN ==================== -->
    <div id="createGroupScreen" class="form-screen">
        <div class="form-header">
            <button class="form-back-btn" onclick="goBackFromCreate()">‚Üê</button>
            <div class="form-title">Create Group</div>
        </div>
        <div class="form-content">
            <div class="form-group">
                <label class="form-label">Group Name</label>
                <input type="text" class="form-input" id="groupNameInput" placeholder="e.g. Summer Trip 2025">
            </div>
            <div class="form-group">
                <label class="form-label">Group Photo</label>
                <div id="photoPreviewContainer" style="display: none; margin-bottom: 12px;">
                    <div style="position: relative; display: inline-block;">
                        <img id="photoPreview" style="width: 100px; height: 100px; border-radius: 16px; object-fit: cover; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                        <button onclick="removePhoto()" style="position: absolute; top: -8px; right: -8px; width: 24px; height: 24px; border-radius: 50%; background: #ff6b6b; color: white; border: none; font-size: 14px; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.2);">√ó</button>
                    </div>
                </div>
                <div class="photo-picker" id="photoPicker">
                    <div class="photo-option" onclick="pickPhoto()">
                        <div class="photo-option-icon">üñºÔ∏è</div>
                        <div class="photo-option-text">Choose Photo</div>
                    </div>
                    <div class="photo-option" onclick="takePhoto()">
                        <div class="photo-option-icon">üì∑</div>
                        <div class="photo-option-text">Take Picture</div>
                    </div>
                </div>
                <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="handlePhotoSelect(event)">
                <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;" onchange="handlePhotoSelect(event)">
            </div>
            <div class="form-group">
                <label class="form-label">Description (optional)</label>
                <input type="text" class="form-input" id="groupDescInput" placeholder="What's this group for?">
            </div>
            <button class="form-submit-btn" onclick="createGroup()">Create Group</button>
        </div>
    </div>

    <!-- ==================== JOIN GROUP SCREEN ==================== -->
    <div id="joinGroupScreen" class="form-screen">
        <div class="form-header">
            <button class="form-back-btn" onclick="goBackFromJoin()">‚Üê</button>
            <div class="form-title">Join Group</div>
        </div>
        <div class="form-content">
            <div class="form-group">
                <label class="form-label">Enter Invite Code</label>
                <input type="text" class="form-input form-input-code" id="inviteCodeInput" placeholder="ABC123" maxlength="6" oninput="this.value = this.value.toUpperCase()">
            </div>
            <div class="form-hint">
                Ask your friend for the 6-digit<br>group invite code
            </div>
            <button class="form-submit-btn" onclick="joinGroup()">Join Group</button>
        </div>
    </div>

    <!-- ==================== GROUPS LIST SCREEN ==================== -->
    <div id="groupsListScreen" class="groups-list-screen">
        <div class="groups-header">
            <div class="groups-header-top">
                <div class="groups-title">My Groups</div>
                <button class="logout-btn" onclick="handleLogout()" title="Sign Out">
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16 17 21 12 16 7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                </button>
            </div>
            <div class="groups-subtitle" id="groupsSubtitle">All your groups</div>
        </div>
        <div class="groups-list-content" id="groupsListContent">
            <!-- Groups will be rendered dynamically -->
        </div>
        <div class="bottom-nav">
            <!-- Home -->
            <button class="bottom-nav-item active">
                <div class="bottom-nav-icon">
                    <svg viewBox="0 0 24 24">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9 22 9 12 15 12 15 22"/>
                    </svg>
                </div>
                <span class="bottom-nav-label">Home</span>
            </button>
            <!-- Restaurants - Storefront -->
            <button class="bottom-nav-item">
                <div class="bottom-nav-icon">
                    <svg viewBox="0 0 24 24">
                        <path d="M3 9V21H21V9"/>
                        <path d="M21 9L19 3H5L3 9"/>
                        <path d="M3 9C3 9 3 11 5.5 11C8 11 8 9 8 9"/>
                        <path d="M8 9C8 9 8 11 10.5 11C13 11 13 9 13 9"/>
                        <path d="M13 9C13 9 13 11 15.5 11C18 11 18 9 18 9"/>
                        <path d="M18 9C18 9 18 11 20.5 11C21 11 21 10.5 21 9"/>
                        <rect x="9" y="14" width="6" height="7"/>
                    </svg>
                </div>
                <span class="bottom-nav-label">Places</span>
            </button>
            <!-- Center Add Button -->
            <button class="bottom-nav-item center-btn" onclick="showCreateGroup()">
                <div class="bottom-nav-icon">
                    <svg viewBox="0 0 24 24">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                </div>
            </button>
            <!-- Food Items - Pizza Slice -->
            <button class="bottom-nav-item">
                <div class="bottom-nav-icon">
                    <svg viewBox="0 0 24 24">
                        <g transform="rotate(40 12 12)">
                            <path d="M4.5 6C6.5 3 9 2 12 2s5.5 1 7.5 4L12 22 4.5 6z"/>
                            <path d="M6 7.5c1.5-1.5 3.5-2.5 6-2.5s4.5 1 6 2.5"/>
                            <circle cx="9" cy="9.5" r="1.8" class="filled"/>
                            <circle cx="14" cy="8.5" r="1.4" class="filled"/>
                            <circle cx="11" cy="13.5" r="1.2" class="filled"/>
                        </g>
                    </svg>
                </div>
                <span class="bottom-nav-label">Food</span>
            </button>
            <!-- Menu -->
            <button class="bottom-nav-item">
                <div class="bottom-nav-icon">
                    <svg viewBox="0 0 24 24">
                        <line x1="3" y1="6" x2="21" y2="6"/>
                        <line x1="3" y1="12" x2="21" y2="12"/>
                        <line x1="3" y1="18" x2="21" y2="18"/>
                    </svg>
                </div>
                <span class="bottom-nav-label">Menu</span>
            </button>
        </div>
    </div>

    <!-- ==================== MAIN APP ==================== -->
    <div id="mainApp" class="main-app">
    <div class="header">
        <div class="header-top">
            <div class="header-search">
                <input type="text" id="searchInput" placeholder="üîç Search restaurants, cuisine, or notes..." autocomplete="off">
                <div class="search-dropdown" id="searchDropdown"></div>
            </div>
            <button class="menu-btn" onclick="openFilterModal()">
                <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                    <line x1="4" y1="6" x2="20" y2="6"/>
                    <line x1="4" y1="12" x2="20" y2="12"/>
                    <line x1="4" y1="18" x2="20" y2="18"/>
                    <circle cx="8" cy="6" r="2" fill="currentColor"/>
                    <circle cx="16" cy="12" r="2" fill="currentColor"/>
                    <circle cx="10" cy="18" r="2" fill="currentColor"/>
                </svg>
            </button>
        </div>
    </div>

    <div class="filter-modal" id="filterModal">
        <div class="filter-modal-content">
            <div class="filter-modal-header">
                <h2 class="filter-modal-title">Filter</h2>
                <button class="filter-reset-btn" onclick="resetFilters()">Reset</button>
            </div>

            <div class="filter-section">
                <h3 class="filter-section-title">Main Category</h3>
                <div class="filter-main-categories" id="filterMainCategories">
                    <button class="filter-category-btn active" data-category="all" onclick="selectFilterMainCategory('all')">üçΩÔ∏è All</button>
                    <button class="filter-category-btn" data-category="restaurant" onclick="selectFilterMainCategory('restaurant')">üç¥ Restaurant</button>
                    <button class="filter-category-btn" data-category="dessert" onclick="selectFilterMainCategory('dessert')">üç∞ Dessert</button>
                    <button class="filter-category-btn" data-category="icecream" onclick="selectFilterMainCategory('icecream')">üç¶ Ice Cream</button>
                    <button class="filter-category-btn" data-category="drinks" onclick="selectFilterMainCategory('drinks')">üçπ Drinks</button>
                </div>
            </div>

            <div class="filter-section" id="filterSubcategorySection" style="display: none;">
                <h3 class="filter-section-title">Subcategory</h3>
                <div class="filter-subcategories" id="filterSubcategories">
                    <!-- Subcategories will be populated dynamically -->
                </div>
            </div>

            <div class="filter-section">
                <h3 class="filter-section-title">Rating</h3>
                <div class="filter-rating-chips">
                    <button class="rating-chip" onclick="toggleRating(this, 1)">1‚≠ê</button>
                    <button class="rating-chip" onclick="toggleRating(this, 2)">2‚≠ê</button>
                    <button class="rating-chip" onclick="toggleRating(this, 3)">3‚≠ê</button>
                    <button class="rating-chip" onclick="toggleRating(this, 4)">4‚≠ê</button>
                    <button class="rating-chip" onclick="toggleRating(this, 5)">5‚≠ê</button>
                </div>
            </div>

            <div class="filter-section">
                <h3 class="filter-section-title" id="filterPriceTitle">Price</h3>
                <div class="price-slider-container" id="filterPriceChips">
                    <button class="price-chip" onclick="togglePrice(this, 1)">‚Ç¨ <small>Under ‚Ç¨15</small></button>
                    <button class="price-chip" onclick="togglePrice(this, 2)">‚Ç¨‚Ç¨ <small>‚Ç¨15-30</small></button>
                    <button class="price-chip" onclick="togglePrice(this, 3)">‚Ç¨‚Ç¨‚Ç¨ <small>‚Ç¨30-60</small></button>
                    <button class="price-chip" onclick="togglePrice(this, 4)">‚Ç¨‚Ç¨‚Ç¨‚Ç¨ <small>‚Ç¨60+</small></button>
                </div>
            </div>

            <div id="filterResultCount" style="text-align: center; color: #636e72; font-size: 14px; margin-top: 16px;">
                Showing all restaurants
            </div>
            <button class="filter-show-results-btn" onclick="applyFilters()">Show results</button>
        </div>
    </div>

    <button class="demo-btn" id="demoPinBtn" onclick="openDemoMenu()">üé® Pin Styles</button>
    <!-- Old floating add button - now in bottom nav -->

    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
    
    <div class="sidebar" id="sidebar">
        <div id="restaurantsSidebarView">
            <div class="sidebar-header">
                <h2>Browse</h2>
                <button class="sidebar-close" onclick="toggleSidebar()">√ó</button>
            </div>
            
            <div class="profile-section">
                <div class="profile-avatar">üë§</div>
                <div class="profile-name">Food Explorer</div>
                <div class="profile-location">Makarska, Croatia</div>
                <div class="profile-tabs">
                    <button class="profile-tab" id="menuTab" onclick="switchTab('menu')">Menu Items</button>
                    <button class="profile-tab active" id="restaurantTab" onclick="switchTab('restaurant')">Restaurants</button>
                </div>
            </div>

            <div class="sidebar-content">
                <div id="menuReviewsSection" style="display: none;">
                    <div class="sidebar-section">
                        <h3>üçï Menu Items Reviews</h3>
                        <div class="review-cards" id="menuReviewCards"></div>
                    </div>
                </div>

                <div id="restaurantReviewsSection">
                    <div class="sidebar-section">
                        <h3>üçΩÔ∏è All Restaurants (<span id="restaurantCount">0</span>)</h3>
                        <ul class="sidebar-list" id="restaurantList"></ul>
                    </div>
                    <div class="sidebar-section">
                        <h3>ü•ò Cuisines</h3>
                        <ul class="sidebar-list" id="cuisineList"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="map"></div>

    <div id="restaurantsListView" class="restaurants-list-view" style="display: none;">
        <div class="dishes-header">
            <div class="dishes-title-row">
                <h2 class="dishes-title">Restaurants</h2>
            </div>

            <div class="dishes-search-container">
                <input type="text" class="dishes-search-input" id="restaurantsSearchInput" placeholder="Search restaurants..." oninput="filterRestaurantsList()">
            </div>

            <div class="dish-filters" id="restaurantCategoryFilters">
                <button class="dish-filter-btn active" data-category="all" onclick="selectRestaurantCategory('all')">üçΩÔ∏è All</button>
                <button class="dish-filter-btn" data-category="restaurant" onclick="selectRestaurantCategory('restaurant')">üç¥ Restaurant</button>
                <button class="dish-filter-btn" data-category="dessert" onclick="selectRestaurantCategory('dessert')">üç∞ Dessert</button>
                <button class="dish-filter-btn" data-category="icecream" onclick="selectRestaurantCategory('icecream')">üç¶ Ice Cream</button>
                <button class="dish-filter-btn" data-category="drinks" onclick="selectRestaurantCategory('drinks')">üçπ Drinks</button>
            </div>
        </div>
        <div id="restaurantsListContainer"></div>
    </div>

    <div id="topDishesView" class="restaurants-list-view" style="display: none;">
        <div class="dishes-header">
            <div class="dishes-title-row">
                <h2 class="dishes-title">Top Rated Dishes</h2>
            </div>

            <div class="dishes-search-container">
                <input type="text" class="dishes-search-input" id="foodSearchInput" placeholder="Search food items..." oninput="filterFoodList()">
            </div>

            <div class="dish-filters" id="mainCategoryFilters">
                <button class="dish-filter-btn active" data-category="all" onclick="selectMainCategory('all')">üçΩÔ∏è All</button>
                <button class="dish-filter-btn" data-category="restaurant" onclick="selectMainCategory('restaurant')">üç¥ Restaurant</button>
                <button class="dish-filter-btn" data-category="dessert" onclick="selectMainCategory('dessert')">üç∞ Dessert</button>
                <button class="dish-filter-btn" data-category="icecream" onclick="selectMainCategory('icecream')">üç¶ Ice Cream</button>
                <button class="dish-filter-btn" data-category="drinks" onclick="selectMainCategory('drinks')">üçπ Drinks</button>
            </div>
            <div class="dish-subcategories" id="subcategoryFilters" style="display: none;">
                <!-- Subcategories will be populated dynamically -->
            </div>
        </div>

        <div class="dishes-list" id="dishesList"></div>
    </div>

    <div class="bottom-nav">
        <!-- Home -->
        <button class="bottom-nav-item active" id="bottomNavHome" onclick="switchBottomNav('home')">
            <div class="bottom-nav-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9 22 9 12 15 12 15 22"/>
                </svg>
            </div>
            <span class="bottom-nav-label">Home</span>
        </button>
        <!-- Restaurants - Storefront -->
        <button class="bottom-nav-item" id="bottomNavRestaurants" onclick="switchBottomNav('restaurants')">
            <div class="bottom-nav-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M3 9V21H21V9"/>
                    <path d="M21 9L19 3H5L3 9"/>
                    <path d="M3 9C3 9 3 11 5.5 11C8 11 8 9 8 9"/>
                    <path d="M8 9C8 9 8 11 10.5 11C13 11 13 9 13 9"/>
                    <path d="M13 9C13 9 13 11 15.5 11C18 11 18 9 18 9"/>
                    <path d="M18 9C18 9 18 11 20.5 11C21 11 21 10.5 21 9"/>
                    <rect x="9" y="14" width="6" height="7"/>
                </svg>
            </div>
            <span class="bottom-nav-label">Places</span>
        </button>
        <!-- Center Add Button -->
        <button class="bottom-nav-item center-btn" onclick="openAddModal()">
            <div class="bottom-nav-icon">
                <svg viewBox="0 0 24 24">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
            </div>
        </button>
        <!-- Food Items - Pizza Slice -->
        <button class="bottom-nav-item" id="bottomNavFood" onclick="switchBottomNav('food')">
            <div class="bottom-nav-icon">
                <svg viewBox="0 0 24 24">
                    <g transform="rotate(40 12 12)">
                        <path d="M4.5 6C6.5 3 9 2 12 2s5.5 1 7.5 4L12 22 4.5 6z"/>
                        <path d="M6 7.5c1.5-1.5 3.5-2.5 6-2.5s4.5 1 6 2.5"/>
                        <circle cx="9" cy="9.5" r="1.8" class="filled"/>
                        <circle cx="14" cy="8.5" r="1.4" class="filled"/>
                        <circle cx="11" cy="13.5" r="1.2" class="filled"/>
                    </g>
                </svg>
            </div>
            <span class="bottom-nav-label">Food</span>
        </button>
        <!-- Menu -->
        <button class="bottom-nav-item" id="bottomNavSettings" onclick="switchBottomNav('settings')">
            <div class="bottom-nav-icon">
                <svg viewBox="0 0 24 24">
                    <line x1="3" y1="6" x2="21" y2="6"/>
                    <line x1="3" y1="12" x2="21" y2="12"/>
                    <line x1="3" y1="18" x2="21" y2="18"/>
                </svg>
            </div>
            <span class="bottom-nav-label">Menu</span>
        </button>
    </div>

    <!-- Settings View - Main Menu -->
    <div id="settingsView" class="restaurants-list-view" style="display: none;">
        <div class="restaurants-integrated-header">
            <div class="restaurants-header-top">
                <div class="restaurants-header-title">
                    <span class="restaurants-header-icon">‚öôÔ∏è</span>
                    <span class="restaurants-header-name">Settings</span>
                </div>
            </div>
        </div>
        
        <div class="settings-content">
            <!-- Group Section -->
            <div class="settings-section-label">Group</div>
            <div class="settings-section">
                <div class="settings-menu-item" onclick="showSettingsPage('groupmembers')">
                    <div class="settings-menu-icon">üë•</div>
                    <div class="settings-menu-info">
                        <div class="settings-menu-title">Group Members</div>
                        <div class="settings-menu-desc">View & manage members</div>
                    </div>
                    <div class="settings-menu-arrow">‚Ä∫</div>
                </div>
                <div class="settings-menu-item" onclick="showGroupsList()">
                    <div class="settings-menu-icon">üìã</div>
                    <div class="settings-menu-info">
                        <div class="settings-menu-title">My Groups</div>
                        <div class="settings-menu-desc">Switch to another group</div>
                    </div>
                    <div class="settings-menu-arrow">‚Ä∫</div>
                </div>
            </div>

            <!-- App Configuration Section -->
            <div class="settings-section-label">App Configuration</div>
            <div class="settings-section">
                <div class="settings-menu-item" onclick="showSettingsPage('categories')">
                    <div class="settings-menu-icon">üìÅ</div>
                    <div class="settings-menu-info">
                        <div class="settings-menu-title">Categories</div>
                        <div class="settings-menu-desc">Manage restaurant categories</div>
                    </div>
                    <div class="settings-menu-arrow">‚Ä∫</div>
                </div>
                <div class="settings-menu-item" onclick="showSettingsPage('subcategories')">
                    <div class="settings-menu-icon">üìÇ</div>
                    <div class="settings-menu-info">
                        <div class="settings-menu-title">Subcategories</div>
                        <div class="settings-menu-desc">Manage food subcategories</div>
                    </div>
                    <div class="settings-menu-arrow">‚Ä∫</div>
                </div>
                <div class="settings-menu-item" onclick="showSettingsPage('priceranges')">
                    <div class="settings-menu-icon">üí∞</div>
                    <div class="settings-menu-info">
                        <div class="settings-menu-title">Price Ranges</div>
                        <div class="settings-menu-desc">Customize price filters</div>
                    </div>
                    <div class="settings-menu-arrow">‚Ä∫</div>
                </div>
            </div>
            
            <!-- Pin Location Help -->
            <div style="background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white; padding: 16px; border-radius: 12px; margin-top: 8px;">
                <p style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">üìç Justera pin-positioner</p>
                <p style="font-size: 13px; line-height: 1.5; opacity: 0.95;">
                    <strong>S√• h√§r flyttar du en pin:</strong><br>
                    1. Klicka p√• en restaurang i listan<br>
                    2. Klicka p√• <strong>"üìç Flytta pin"</strong><br>
                    3. Klicka p√• r√§tt plats p√• kartan<br>
                    4. Klart! ‚úÖ
                </p>
            </div>
        </div>
    </div>

    <!-- Settings Sub-Page: Group Members -->
    <div id="settingsGroupMembersView" class="restaurants-list-view" style="display: none;">
        <div class="restaurants-integrated-header">
            <div class="restaurants-header-top">
                <div class="restaurants-header-title">
                    <button class="settings-back-btn" onclick="hideSettingsPage('groupmembers')">‚Üê</button>
                    <span class="restaurants-header-icon">üë•</span>
                    <span class="restaurants-header-name">Group Members</span>
                </div>
                <button class="settings-add-btn" onclick="showSettingsPage('invitemembers')">+ Add</button>
            </div>
        </div>
        <div class="settings-content">
            <div class="settings-group-header">
                <div class="settings-group-name" id="currentGroupName">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Trip 2025</div>
                <div class="settings-group-meta" id="currentGroupMeta">5 members</div>
            </div>
            <div id="groupMembersList" class="settings-list">
                <!-- Members will be rendered dynamically -->
            </div>
        </div>
    </div>

    <!-- Settings Sub-Page: Invite Members -->
    <div id="settingsInviteMembersView" class="restaurants-list-view" style="display: none;">
        <div class="restaurants-integrated-header">
            <div class="restaurants-header-top">
                <div class="restaurants-header-title">
                    <button class="settings-back-btn" onclick="showSettingsPage('groupmembers')">‚Üê</button>
                    <span class="restaurants-header-icon">‚úâÔ∏è</span>
                    <span class="restaurants-header-name">Invite Members</span>
                </div>
            </div>
        </div>
        <div class="settings-content">
            <div class="invite-code-box">
                <div class="invite-emoji">üéâ</div>
                <div class="invite-label">Share this code with friends</div>
                <div class="invite-code" id="inviteCodeDisplay">------</div>
                <button class="invite-copy-btn" onclick="copyCurrentGroupCode()">üìã Copy Code</button>
            </div>
            <div class="invite-share-section">
                <div class="invite-share-label">or share via</div>
                <div class="invite-share-buttons">
                    <button class="share-btn share-whatsapp" onclick="shareViaWhatsApp()">üí¨</button>
                    <button class="share-btn share-email" onclick="shareViaEmail()">‚úâÔ∏è</button>
                    <button class="share-btn share-link" onclick="shareViaLink()">üîó</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Sub-Page: Categories -->
    <div id="settingsCategoriesView" class="restaurants-list-view" style="display: none;">
        <div class="restaurants-integrated-header">
            <div class="restaurants-header-top">
                <div class="restaurants-header-title">
                    <button class="settings-back-btn" onclick="hideSettingsPage('categories')">‚Üê</button>
                    <span class="restaurants-header-icon">üìÅ</span>
                    <span class="restaurants-header-name">Categories</span>
                </div>
                <button class="settings-add-btn" onclick="openAddCategoryModal()">+ Add</button>
            </div>
        </div>
        <div class="settings-content">
            <div id="categoriesList" class="settings-list"></div>
        </div>
    </div>

    <!-- Settings Sub-Page: Subcategories -->
    <div id="settingsSubcategoriesView" class="restaurants-list-view" style="display: none;">
        <div class="restaurants-integrated-header">
            <div class="restaurants-header-top">
                <div class="restaurants-header-title">
                    <button class="settings-back-btn" onclick="hideSettingsPage('subcategories')">‚Üê</button>
                    <span class="restaurants-header-icon">üìÇ</span>
                    <span class="restaurants-header-name">Subcategories</span>
                </div>
                <button class="settings-add-btn" onclick="openAddSubcategoryModal()">+ Add</button>
            </div>
        </div>
        <div class="settings-content">
            <div id="subcategoriesList" class="settings-list"></div>
        </div>
    </div>

    <!-- Settings Sub-Page: Price Ranges -->
    <div id="settingsPriceRangesView" class="restaurants-list-view" style="display: none;">
        <div class="restaurants-integrated-header">
            <div class="restaurants-header-top">
                <div class="restaurants-header-title">
                    <button class="settings-back-btn" onclick="hideSettingsPage('priceranges')">‚Üê</button>
                    <span class="restaurants-header-icon">üí∞</span>
                    <span class="restaurants-header-name">Price Ranges</span>
                </div>
                <button class="settings-add-btn" onclick="openAddPriceRangeModal()">+ Add</button>
            </div>
        </div>
        <div class="settings-content">
            <div id="priceRangesList" class="settings-list"></div>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div id="addCategoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Category</h2>
                <button class="close-btn" onclick="closeAddCategoryModal()">√ó</button>
            </div>
            <form id="categoryForm">
                <div class="form-group">
                    <label>Category Name</label>
                    <input type="text" id="categoryName" placeholder="e.g., Bakery">
                </div>
                <div class="form-group">
                    <label>Emoji Icon</label>
                    <div class="emoji-input-wrapper">
                        <input type="text" id="categoryEmoji" placeholder="Tap to select">
                        <div class="emoji-picker" id="categoryEmojiPicker">
                            <span onclick="selectEmoji('categoryEmoji', 'üç¥')">üç¥</span>
                            <span onclick="selectEmoji('categoryEmoji', 'üçï')">üçï</span>
                            <span onclick="selectEmoji('categoryEmoji', 'üçî')">üçî</span>
                            <span onclick="selectEmoji('categoryEmoji', 'üåÆ')">üåÆ</span>
                            <span onclick="selectEmoji('categoryEmoji', 'üçú')">üçú</span>
                            <span onclick="selectEmoji('categoryEmoji', 'üç£')">üç£</span>
                            <span onclick="selectEmoji('categoryEmoji', 'ü•ê')">ü•ê</span>
                            <span onclick="selectEmoji('categoryEmoji', 'ü•ó')">ü•ó</span>
                            <span onclick="selectEmoji('categoryEmoji', 'ü•©')">ü•©</span>
                            <span onclick="selectEmoji('categoryEmoji', 'üêü')">üêü</span>
                            <span onclick="selectEmoji('categoryEmoji', 'ü¶ê')">ü¶ê</span>
                            <span onclick="selectEmoji('categoryEmoji', 'üçù')">üçù</span>
                            <span onclick="selectEmoji('categoryEmoji', 'üç∞')">üç∞</span>
                            <span onclick="selectEmoji('categoryEmoji', 'üç¶')">üç¶</span>
                            <span onclick="selectEmoji('categoryEmoji', 'üç©')">üç©</span>
                            <span onclick="selectEmoji('categoryEmoji', 'üßÅ')">üßÅ</span>
                            <span onclick="selectEmoji('categoryEmoji', 'üç™')">üç™</span>
                            <span onclick="selectEmoji('categoryEmoji', '‚òï')">‚òï</span>
                            <span onclick="selectEmoji('categoryEmoji', 'üçπ')">üçπ</span>
                            <span onclick="selectEmoji('categoryEmoji', 'üç∑')">üç∑</span>
                            <span onclick="selectEmoji('categoryEmoji', 'üç∫')">üç∫</span>
                            <span onclick="selectEmoji('categoryEmoji', 'ü•§')">ü•§</span>
                            <span onclick="selectEmoji('categoryEmoji', 'üßÉ')">üßÉ</span>
                            <span onclick="selectEmoji('categoryEmoji', 'üè™')">üè™</span>
                        </div>
                    </div>
                </div>
                <button type="button" class="submit-btn" onclick="saveCategory()">Save Category</button>
            </form>
        </div>
    </div>

    <!-- Add Subcategory Modal -->
    <div id="addSubcategoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Subcategory</h2>
                <button class="close-btn" onclick="closeAddSubcategoryModal()">√ó</button>
            </div>
            <form id="subcategoryForm">
                <div class="form-group">
                    <label>Parent Category</label>
                    <select id="parentCategory">
                        <option value="">Select category...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Subcategory Name</label>
                    <input type="text" id="subcategoryName" placeholder="e.g., Croissants">
                </div>
                <div class="form-group">
                    <label>Emoji Icon</label>
                    <div class="emoji-input-wrapper">
                        <input type="text" id="subcategoryEmoji" placeholder="Tap to select">
                        <div class="emoji-picker" id="subcategoryEmojiPicker">
                            <span onclick="selectEmoji('subcategoryEmoji', 'üç¥')">üç¥</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'üçï')">üçï</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'üçî')">üçî</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'üåÆ')">üåÆ</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'üçú')">üçú</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'üç£')">üç£</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'ü•ê')">ü•ê</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'ü•ó')">ü•ó</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'ü•©')">ü•©</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'üêü')">üêü</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'ü¶ê')">ü¶ê</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'üçù')">üçù</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'üç∞')">üç∞</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'üç¶')">üç¶</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'üç©')">üç©</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'üßÅ')">üßÅ</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'üç™')">üç™</span>
                            <span onclick="selectEmoji('subcategoryEmoji', '‚òï')">‚òï</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'üçπ')">üçπ</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'üç∑')">üç∑</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'üç∫')">üç∫</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'ü•§')">ü•§</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'üßÉ')">üßÉ</span>
                            <span onclick="selectEmoji('subcategoryEmoji', 'üè™')">üè™</span>
                        </div>
                    </div>
                </div>
                <button type="button" class="submit-btn" onclick="saveSubcategory()">Save Subcategory</button>
            </form>
        </div>
    </div>

    <!-- Add Price Range Modal -->
    <div id="addPriceRangeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Price Range</h2>
                <button class="close-btn" onclick="closeAddPriceRangeModal()">√ó</button>
            </div>
            <form id="priceRangeForm" onsubmit="savePriceRange(event)">
                <div class="form-group">
                    <label>Apply To</label>
                    <select id="priceRangeTarget" required onchange="updatePriceRangeTargetOptions()">
                        <option value="">Select...</option>
                        <option value="category">Category</option>
                        <option value="subcategory">Subcategory</option>
                    </select>
                </div>
                <div class="form-group" id="priceRangeCategoryGroup" style="display: none;">
                    <label>Category</label>
                    <select id="priceRangeCategory">
                        <option value="">Select category...</option>
                    </select>
                </div>
                <div class="form-group" id="priceRangeSubcategoryGroup" style="display: none;">
                    <label>Subcategory</label>
                    <select id="priceRangeSubcategory">
                        <option value="">Select subcategory...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Price Level (1-4)</label>
                    <select id="priceRangeLevel" required>
                        <option value="1">‚Ç¨ (Level 1)</option>
                        <option value="2">‚Ç¨‚Ç¨ (Level 2)</option>
                        <option value="3">‚Ç¨‚Ç¨‚Ç¨ (Level 3)</option>
                        <option value="4">‚Ç¨‚Ç¨‚Ç¨‚Ç¨ (Level 4)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Label</label>
                    <input type="text" id="priceRangeLabel" placeholder="e.g., ‚Ç¨" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" id="priceRangeDesc" placeholder="e.g., Under ‚Ç¨5" required>
                </div>
                <button type="submit" class="submit-btn">Save Price Range</button>
            </form>
        </div>
    </div>

    <div id="addChoiceModal" class="modal">
        <div class="modal-content" style="padding-bottom: 30px;">
            <div class="modal-header">
                <h2>What would you like to add?</h2>
                <button class="close-btn" onclick="closeAddChoiceModal()">√ó</button>
            </div>
            <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 10px;">
                <button class="add-choice-btn" onclick="openAddRestaurantModal()">
                    <span class="add-choice-icon">üè™</span>
                    <div class="add-choice-text">
                        <div class="add-choice-title">Add Restaurant</div>
                        <div class="add-choice-desc">Add a new restaurant location</div>
                    </div>
                </button>
                <button class="add-choice-btn" onclick="openAddFoodModal()">
                    <span class="add-choice-icon">üçΩÔ∏è</span>
                    <div class="add-choice-text">
                        <div class="add-choice-title">Add Food Item</div>
                        <div class="add-choice-desc">Add a dish to an existing restaurant</div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <div id="addRestaurantModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Restaurant</h2>
                <button class="close-btn" onclick="closeAddRestaurantModal()">√ó</button>
            </div>
            <form id="restaurantForm">
                <div class="form-group" style="position: relative;">
                    <label>Restaurant Name</label>
                    <input type="text" id="name" placeholder="Enter restaurant name..." required autocomplete="off">
                    <div id="autocompleteResults" class="autocomplete-results"></div>
                </div>
                <div class="form-group">
                    <label>Cuisine Type</label>
                    <select id="cuisine" required>
                        <option value="Croatian">Croatian</option>
                        <option value="Seafood">Seafood</option>
                        <option value="Italian">Italian</option>
                        <option value="Mediterranean">Mediterranean</option>
                        <option value="Pizza">Pizza</option>
                        <option value="Steakhouse">Steakhouse</option>
                        <option value="Asian">Asian</option>
                        <option value="Mexican">Mexican</option>
                        <option value="Cafe">Cafe</option>
                        <option value="International">International</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Price Range</label>
                    <select id="price" required>
                        <option value="1">‚Ç¨ - Budget (Under ‚Ç¨15)</option>
                        <option value="2">‚Ç¨‚Ç¨ - Moderate (‚Ç¨15-30)</option>
                        <option value="3">‚Ç¨‚Ç¨‚Ç¨ - Upscale (‚Ç¨30-60)</option>
                        <option value="4">‚Ç¨‚Ç¨‚Ç¨‚Ç¨ - Fine Dining (‚Ç¨60+)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>üìç Location</label>
                    <div class="location-picker-btn" onclick="openLocationPicker()">
                        <span class="location-picker-icon">üó∫Ô∏è</span>
                        <span class="location-picker-text" id="locationText">Tap to select location on map</span>
                        <span class="location-picker-arrow">‚Ä∫</span>
                    </div>
                    <input type="hidden" id="location" value="">
                    <input type="hidden" id="lat">
                    <input type="hidden" id="lng">
                </div>
                <div class="form-group">
                    <label>üì∏ Restaurant Photo</label>
                    <div class="food-photo-section">
                        <div class="food-photo-preview" id="restaurantPhotoPreview">
                            <div class="food-photo-empty">
                                <span>üè™</span>
                                <span>No photo added</span>
                            </div>
                        </div>
                        <div class="food-photo-buttons">
                            <button type="button" class="food-photo-btn camera" onclick="triggerRestaurantCamera()">
                                <span>üì∑</span> Camera
                            </button>
                            <button type="button" class="food-photo-btn gallery" onclick="triggerRestaurantGallery()">
                                <span>üñºÔ∏è</span> Gallery
                            </button>
                            <button type="button" class="food-photo-btn remove" id="removeRestaurantPhotoBtn" onclick="removeRestaurantPhoto()" style="display: none;">
                                <span>‚úï</span> Remove
                            </button>
                        </div>
                        <input type="file" id="restaurantCameraInput" class="photo-upload-input" accept="image/*" capture="environment" onchange="handleRestaurantPhotoSelect(event)">
                        <input type="file" id="restaurantGalleryInput" class="photo-upload-input" accept="image/*" onchange="handleRestaurantPhotoSelect(event)">
                        <input type="hidden" id="restaurantPhotoData" value="">
                    </div>
                </div>
                <button type="submit" class="submit-btn" onclick="saveRestaurant(event)">Save Restaurant</button>
            </form>
        </div>
    </div>

    <div id="addFoodModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Food Item</h2>
                <button class="close-btn" onclick="closeAddFoodModal()">√ó</button>
            </div>
            <form id="foodForm">
                <div class="form-group">
                    <label>Select Restaurant</label>
                    <select id="foodRestaurant" required>
                        <option value="">Choose a restaurant...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="foodCategory" required onchange="populateFoodSubcategories()">
                        <option value="">Choose category...</option>
                    </select>
                </div>
                <div class="form-group" id="foodSubcategoryGroup" style="display: none;">
                    <label>Subcategory</label>
                    <select id="foodSubcategory">
                        <option value="">Choose subcategory...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Dish Name</label>
                    <input type="text" id="dishName" placeholder="e.g., Grilled Sea Bass" required>
                </div>
                <div class="form-group">
                    <label>Price (optional)</label>
                    <input type="text" id="dishPrice" placeholder="e.g., ‚Ç¨15">
                </div>
                <div class="rating-group">
                    <div class="rating-item">
                        <label>Food Rating</label>
                        <div class="stars" id="foodStars">
                            <span class="star" data-rating="food" data-value="1">‚òÖ</span>
                            <span class="star" data-rating="food" data-value="2">‚òÖ</span>
                            <span class="star" data-rating="food" data-value="3">‚òÖ</span>
                            <span class="star" data-rating="food" data-value="4">‚òÖ</span>
                            <span class="star" data-rating="food" data-value="5">‚òÖ</span>
                        </div>
                        <input type="hidden" id="foodRating" value="0">
                    </div>
                    <div class="rating-item">
                        <label>Service</label>
                        <div class="stars" id="serviceStars">
                            <span class="star" data-rating="service" data-value="1">‚òÖ</span>
                            <span class="star" data-rating="service" data-value="2">‚òÖ</span>
                            <span class="star" data-rating="service" data-value="3">‚òÖ</span>
                            <span class="star" data-rating="service" data-value="4">‚òÖ</span>
                            <span class="star" data-rating="service" data-value="5">‚òÖ</span>
                        </div>
                        <input type="hidden" id="serviceRating" value="0">
                    </div>
                </div>
                <div class="form-group">
                    <label>Visit Date</label>
                    <input type="date" id="visitDate" required>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="foodNotes" placeholder="How was it? Any memorable details?"></textarea>
                </div>
                <div class="form-group">
                    <label>üì∏ Food Photo</label>
                    <div class="food-photo-section">
                        <div class="food-photo-preview" id="foodPhotoPreview">
                            <div class="food-photo-empty">
                                <span>üì∑</span>
                                <span>No photo added</span>
                            </div>
                        </div>
                        <div class="food-photo-buttons">
                            <button type="button" class="food-photo-btn camera" onclick="triggerFoodCamera()">
                                <span>üì∑</span> Take Photo
                            </button>
                            <button type="button" class="food-photo-btn gallery" onclick="triggerFoodGallery()">
                                <span>üñºÔ∏è</span> Gallery
                            </button>
                            <button type="button" class="food-photo-btn remove" id="removeFoodPhotoBtn" onclick="removeFoodPhoto()" style="display: none;">
                                <span>‚úï</span> Remove
                            </button>
                        </div>
                        <input type="file" id="foodCameraInput" class="photo-upload-input" accept="image/*" capture="environment" onchange="handleFoodPhotoSelect(event)">
                        <input type="file" id="foodGalleryInput" class="photo-upload-input" accept="image/*" onchange="handleFoodPhotoSelect(event)">
                        <input type="hidden" id="foodPhotoData" value="">
                    </div>
                </div>
                <button type="submit" class="submit-btn" onclick="saveFoodItem(event)">Save Food Item</button>
            </form>
        </div>
    </div>

    <div id="viewModal" class="restaurant-detail-modal">
        <div class="restaurant-detail-overlay" onclick="closeViewModal()"></div>
        <div class="restaurant-detail-content">
            <div class="restaurant-detail-hero" id="restaurantHero">
                <!-- Hero image or gradient will be inserted here -->
            </div>
            <button class="restaurant-detail-close" onclick="closeViewModal()">√ó</button>
            <div class="restaurant-detail-body" id="restaurantDetails"></div>
        </div>
    </div>

    <!-- Location Picker Modal -->
    <div id="locationPickerModal" class="location-picker-modal">
        <div class="location-picker-header">
            <button class="location-picker-back" onclick="closeLocationPicker()">‚úï</button>
            <h2>Select Location</h2>
            <button class="location-picker-confirm" id="confirmLocationBtn" onclick="confirmLocation()">Done</button>
        </div>
        <div class="location-picker-search">
            <input type="text" id="locationSearchInput" placeholder="üîç Search for a place...">
        </div>
        <div id="locationPickerMap" class="location-picker-map"></div>
        <div class="location-picker-instructions">
            <span>üìç</span> Tap on the map to drop a pin
        </div>
    </div>

    <div id="dishDetailModal" class="dish-detail-modal">
        <div class="dish-detail-content">
            <div class="dish-detail-header" id="dishDetailImage">
                üçï
            </div>
            <button class="dish-detail-close" onclick="closeDishDetail()">√ó</button>
            <div class="dish-detail-body" id="dishDetailBody"></div>
        </div>
    </div>

    <div id="demoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Choose Pin Style</h2>
                <button class="close-btn" onclick="closeDemoMenu()">√ó</button>
            </div>
            <p style="color: #636e72; margin-bottom: 20px; font-size: 14px;">Select your preferred marker style for the map</p>
            <div class="pin-options">
                <div class="pin-option selected" data-pin-type="float-card" onclick="selectPin('float-card')" style="grid-column: 1 / -1; padding: 20px;">
                    <div class="pin-name" style="margin-bottom: 8px; font-size: 16px;">Float Card</div>
                    <div class="pin-desc" style="margin-bottom: 16px;">Shows name + category/price/rating info</div>
                    
                    <div style="display: flex; gap: 16px; flex-wrap: wrap; justify-content: space-between;">
                        <!-- Card 1: Category Example -->
                        <div style="text-align: center; flex: 1; min-width: 140px;">
                            <div style="font-size: 10px; color: #636e72; margin-bottom: 6px;">üìÇ Category</div>
                            <div style="display: flex; align-items: center; background: white; border-radius: 20px; padding: 6px 14px 6px 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.12); gap: 8px; justify-content: center;">
                                <div style="width: 32px; height: 32px; background: #ff6b6b; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 15px;">üç¥</div>
                                <div style="line-height: 1.2; text-align: left;"><div style="font-size: 12px; font-weight: 700; color: #2d3436;">Restaurant</div><div style="font-size: 10px; color: #636e72;">250m</div></div>
                            </div>
                        </div>
                        
                        <!-- Card 2: Price Example -->
                        <div style="text-align: center; flex: 1; min-width: 140px;">
                            <div style="font-size: 10px; color: #636e72; margin-bottom: 6px;">üí∞ Price</div>
                            <div style="display: flex; align-items: center; background: white; border-radius: 20px; padding: 6px 14px 6px 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.12); gap: 8px; justify-content: center;">
                                <div style="width: 32px; height: 32px; background: #ff6b6b; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 15px;">üç¥</div>
                                <div style="line-height: 1.2; text-align: left;"><div style="font-size: 12px; font-weight: 700; color: #2d3436;">La Trattoria</div><div style="font-size: 10px; color: #51cf66;">‚Ç¨5-15</div></div>
                            </div>
                        </div>
                        
                        <!-- Card 3: Rating Example -->
                        <div style="text-align: center; flex: 1; min-width: 140px;">
                            <div style="font-size: 10px; color: #636e72; margin-bottom: 6px;">‚≠ê Rating</div>
                            <div style="display: flex; align-items: center; background: white; border-radius: 20px; padding: 6px 14px 6px 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.12); gap: 8px; justify-content: center;">
                                <div style="width: 32px; height: 32px; background: #ff6b6b; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 15px;">üç¥</div>
                                <div style="line-height: 1.2; text-align: left;"><div style="font-size: 12px; font-weight: 700; color: #2d3436;">Old Tavern</div><div style="font-size: 10px; color: #ff6b6b;">‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ 2.1</div></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="pin-option" data-pin-type="circle-dot" onclick="selectPin('circle-dot')" style="grid-column: 1 / -1; padding: 20px;">
                    <div class="pin-name" style="margin-bottom: 8px; font-size: 16px;">Circle + Dot</div>
                    <div class="pin-desc" style="margin-bottom: 16px;">Modern circle with dot marker - category color with badge indicators</div>
                    
                    <div style="display: flex; gap: 16px; flex-wrap: wrap; justify-content: space-between;">
                        <!-- 1a: Category (Restaurang) -->
                        <div style="text-align: center; flex: 1; min-width: 80px;">
                            <div style="font-size: 10px; color: #636e72; margin-bottom: 6px; font-weight: 600;">1a</div>
                            <div style="display: flex; flex-direction: column; align-items: center;">
                                <div style="width: 50px; height: 50px; background: #ff6b5b; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 16px rgba(0,0,0,0.2); border: 3px solid white;">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z"/></svg>
                                </div>
                                <div style="width: 10px; height: 10px; background: #ff6b5b; border-radius: 50%; margin-top: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.3);"></div>
                            </div>
                            <div style="font-size: 9px; color: #636e72; margin-top: 6px;">üìÇ Category</div>
                        </div>
                        
                        <!-- 1b: Price (Billig) -->
                        <div style="text-align: center; flex: 1; min-width: 80px;">
                            <div style="font-size: 10px; color: #636e72; margin-bottom: 6px; font-weight: 600;">1b</div>
                            <div style="display: flex; flex-direction: column; align-items: center;">
                                <div style="position: relative;">
                                    <div style="width: 50px; height: 50px; background: #ff6b5b; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 16px rgba(0,0,0,0.2); border: 3px solid white;">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z"/></svg>
                                    </div>
                                    <div style="position: absolute; top: -4px; right: -8px; background: #10b981; color: white; font-size: 9px; font-weight: 700; padding: 3px 5px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">$</div>
                                </div>
                                <div style="width: 10px; height: 10px; background: #ff6b5b; border-radius: 50%; margin-top: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.3);"></div>
                            </div>
                            <div style="font-size: 9px; color: #636e72; margin-top: 6px;">üí∞ Price</div>
                        </div>
                        
                        <!-- 1c: Rating (Bra) -->
                        <div style="text-align: center; flex: 1; min-width: 80px;">
                            <div style="font-size: 10px; color: #636e72; margin-bottom: 6px; font-weight: 600;">1c</div>
                            <div style="display: flex; flex-direction: column; align-items: center;">
                                <div style="position: relative;">
                                    <div style="width: 50px; height: 50px; background: #8b5cf6; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 16px rgba(0,0,0,0.2); border: 3px solid white;">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M20 3H4v10c0 2.21 1.79 4 4 4h6c2.21 0 4-1.79 4-4v-3h2c1.11 0 2-.9 2-2V5c0-1.11-.89-2-2-2z"/></svg>
                                    </div>
                                    <div style="position: absolute; top: -4px; left: -8px; background: #10b981; color: white; font-size: 9px; font-weight: 700; padding: 3px 5px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 2px;">
                                        <svg width="8" height="8" viewBox="0 0 24 24" fill="white"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>4.8
                                    </div>
                                </div>
                                <div style="width: 10px; height: 10px; background: #8b5cf6; border-radius: 50%; margin-top: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.3);"></div>
                            </div>
                            <div style="font-size: 9px; color: #636e72; margin-top: 6px;">‚≠ê Rating</div>
                        </div>
                        
                        <!-- 1d: Combined (Price + Rating) -->
                        <div style="text-align: center; flex: 1; min-width: 80px;">
                            <div style="font-size: 10px; color: #636e72; margin-bottom: 6px; font-weight: 600;">1d</div>
                            <div style="display: flex; flex-direction: column; align-items: center;">
                                <div style="position: relative;">
                                    <div style="width: 50px; height: 50px; background: #f59e0b; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 16px rgba(0,0,0,0.2); border: 3px solid white;">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M21 5V3H3v2l8 9v5H6v2h12v-2h-5v-5l8-9z"/></svg>
                                    </div>
                                    <div style="position: absolute; top: -4px; right: -8px; background: #10b981; color: white; font-size: 9px; font-weight: 700; padding: 3px 5px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">$</div>
                                    <div style="position: absolute; top: -4px; left: -8px; background: #10b981; color: white; font-size: 9px; font-weight: 700; padding: 3px 5px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 2px;">
                                        <svg width="8" height="8" viewBox="0 0 24 24" fill="white"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>4.5
                                    </div>
                                </div>
                                <div style="width: 10px; height: 10px; background: #f59e0b; border-radius: 50%; margin-top: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.3);"></div>
                            </div>
                            <div style="font-size: 9px; color: #636e72; margin-top: 6px;">üí∞+‚≠ê Combined</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    </div><!-- END MAIN APP -->

    <!-- Firebase SDK -->

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase-init.js"></script>

    <!-- Leaflet -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/leaflet.markercluster.min.js"></script>
    
    <!-- App -->
    <script src="js/data.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
